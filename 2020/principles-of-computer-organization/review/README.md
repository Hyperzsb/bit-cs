### 计算机组成复习提纲

### 概论

1. **存储程序的概念**

   - 计算机（指硬件）应由运算器、存储器、控制器、输入设备和输出设备五大基本部件组成
   - 计算机内部采用二进制来表示指令和数据
   - 将编好的程序和原始数据事先存入存储器中，然后再启动计算机工作，这就是存储器的基本含义

2. **计算机的主要部件**

   - 输入设备

   - 输出设备

   - 存储器：

     三级存储系统：

     - Cache：CPU可以直接访问，用来存放当前正在执行的程序中的活跃部分（副本），以便快速地向CPU提供指令和数据
     - 主存储器：可由CPU直接访问，用来存放当前正在 执行的程序和数据
     - 辅助存储器：设置在主机外部，CPU不能直接访问，用来存放暂时不参与运行的程序和数据，需要时再传送到主存

   - 运算器：

     算数逻辑部件（ALU）

     运算器的核心是加法器

   - 控制器

3. **总线结构**

   - 总线：

     总线是一组能为多个部件服务的公共信息传送线路，它能分时地发送与接收各部件的信息

   - 特点：

     分时、共享

   - 分类：
     - 地址总线（Address Bus）：由单方向的多根信号线组成，用于 CPU 向主存、外设传输地址信息
     - 数据总线（Data Bus）：由双方向的多根信号线组成，CPU 可以沿这些线从主存或外设读入数据，也可以沿这些线向主存或外设送出数据
     - 控制总线（Control Bus）：上传输的是控制信息，包括 CPU 送出的控制命令和主存/外设反馈给 CPU 的状态信号

4. **存储器设计思想**

   - 冯 · 诺伊曼结构：

     也称普林斯顿结构。是一种将程序指令存储器和数据存储器合并在一起的存储器结构。指令存储地址和数据存储地址指向同一个存储器的不同物理位置

     Intel 公司的 80X86、ARM 公司的 ARM7、 MIPS 公司的 MIPS

   - 哈佛结构：

     哈佛结构是一种将程序指令存储和数据存储分开的存储器结构。CPU 首先到指令存储器中读取指令内容，译码后得到数据地址，再到相应的数据存储器中读取数据，并进行下一步的操作

     哈佛结构的处理器通常具有较高的执行效率。其指令和数据分开组织和存储的，执行时可以预先读取下一条指令

     MOTOROLA 公司的 MC68 系列、 Zilog 公司的 Z8 系列和 ARM 公司的 ARM9、 ARM10 和 ARM11 等

     微机中的 L1 Cache 采用的是哈佛结构， 即分为指令 Cache 和数据 Cache

5. **计算机系统**

   - 计算机系统的组成：

     计算机系统 = 硬件系统 + 软件系统

     硬件通常是指一切看得见，摸得到的设备实体；软件通常是泛指各类程序和文件，它们实际上是由一些算法以及其在计算机中的表示所构成的

   - 硬件与软件的关系：

     硬件是计算机系统的物质基础，软件是计算机系统的灵魂。硬件和软件是相辅相成的，不可分割的整体

     对于程序设计人员来说，硬件和软件在逻辑上是等价的

   - 固件：

     固件是指那些存储在能永久保存信息的器件（如ROM）中的程序，是具有软件功能的硬件。固件的性能指标介于硬件与软件之间，吸收了软、硬件各自的优点，其执行速度快于软件，灵活性优于硬件，是软、硬件结合的产物，计算机功能的固件化将成为计算机发展中的一个趋势

   - 系列机：

     系列机是指一个厂家生产的，具有相同的系统结构，但具有不同组成和实现的一系列不同型号的机器

   - 软件兼容：

     - 向上 / 下兼容：按某档次机器编制的程序，不加修改就能运行在比它更高 / 低档次的机器上
     - 向前 / 后兼容：按某个时期投入市场的某种型号机器编制的程序，不加修改就能运行在它之前 / 后投入市场的机器上

     对系列机的软件向下和向前兼容不做要求，但必须保证向后兼容，力争做到向上兼容

   - 计算机系统的多层次结构：

     - 第 0 级：硬联逻辑（实际机器）
     - 第 1 级：微程序级（实际机器）
     - 第 2 级：机器语言级（实际机器）
     - 第 3 级：操作系统级（虚拟机器）
     - 第 4 级：汇编语言级（虚拟机器）
     - 第 5 级：高级语言级（虚拟机器）
     - 第 6 级：应用语言级（虚拟机器）

   - 实际机器和虚拟机器：

     虚拟计算机是指这个计算机只对该级的观察者存在。对某一层次的观察者来说， 他只能是通过该层次的语言来了解和使用计算机，至于下层是如何工作和实现的就不必关心了

6. **计算机的工作过程**

7. **计算机的主要性能指标**

   - 机器字长：

     机器字长是指参与运算的数的基本位数，它是由加法器、寄存器、数据总线的位数决定的

   - 数据通路宽度：

     数据总线一次所能并行传送信息的位数，称为数据通路宽度。它影响到信息的传送能 力，从而影响计算机的有效处理速度

     这里所说的数据通路宽度是指外部数据总线的宽 度，它与CPU内部的数据总线宽度有可能不同

   - 主存容量：

     一个主存储器所能存储的全部信息量称为主存容量

     字节编址

     字编址

   - 运算速度：

     - 吞吐量和响应时间：

       吞吐量是指系统在单位时间内处理请求的数量

       响应时间是指系统对请求作出响应的时间，响应时间包括 CPU 时间（运行一个程序所花费的时间）与等待时间（用于磁盘访问、存储器访问、I/O 操作、操作系统开销等时间）的总和

     - 主频和 CPU 时钟周期：

       CPU 的主频又称为时钟频率，表示在 CPU 内数字脉冲信号振荡的速度。主频的倒数就是 CPU 时钟周期，这是 CPU 中最小的时间元素

     - CPI：

       就是每条指令执行所用的时钟周期数

     - MIPS 和 MFLOPS：

       MIPS 表示每秒百万条指令：$MIPS=\frac{指令条数}{执行时间 \times 10^6}=\frac{主频}{CPI}$

       MFLOPS 表示每秒百万次浮点运算：$MFLOPS=\frac{浮点操作次数}{执行时间 \times 10^6}$

### 数据的机器层次表示

1. **数值数据的表示**

   - 计算机中的数值数据
   - 无符号数和带符号数
   - 原码表示法：
     - 优点：直观易懂，机器数和真值间的相互转换很容易，用原码实现乘、除运算的规则很简单
     - 缺点：实现加、减运算的规则较复杂
     - 原码表示中，真值 0 有两种不同的表示形式：$[+0]_补=00000,[-0]_补=10000$
   - 补码表示法：
     - 模和同余
     - 补码表示中，真值 0 的表示形式是唯一的：$[+0]_补=[-0]_补=00000$
   - 反码表示法：
     - 反码表示中，真值 0 有两种不同的表示形式：$[+0]_补=00000,[-0]_补=11111$
   - 3 种机器数的比较与转换：
     - 原码、反码表示的正、负数范围相对 0 来说是对称的；但补码负数表示范围较正数表示范围宽，能多表示一个最负的数，其值等于 $-2^n$ 或 $-1$

2. **机器数的定点表示与浮点表示** :book:（P21）

   - 定点表示法：

     - 定点小数
     - 定点整数

   - 浮点表示法：

     - 浮点数的表示范围：

       当 $M=-\frac{1}{2}$ 时，对于原码来说，是规格化数；而对于补码来说，不是规格化数

       当 $M=-1$ 时，对于原码来说，这将无法表示，而对 于补码来说，这是一个规格化数

     - 规格化浮点数

     - 溢出：当运算结果大于最大正数时称为正上溢，小于绝对值最大负数时称为负上溢

   - 浮点数阶码的移码表示：

     移码也称增码或偏码：$X_移=偏置值+X$

     - 移码的特点：
       - 在移码中，最高位为 0 表示负数，最高位为 1 表示正数，与其他表示方法相反
       - 移码全为 0 时，它所对应的真值最小；全为 1 时，它所对应的真值最大。因此，移码的大小直观地反映了真值的大小，这将有助于两个浮点数进行解码的大小比较
       - 真值 0 在移码中的表示形式也是唯一的，即 $[+0]_移=[-0]_移=10000$
       - 同一数值的移码和补码除了最高位相反外，其他各位相同
     - 浮点数阶码常采用移码表示的最主要的原因有两个：
       - 便于比较浮点数的大小
       - 简化机器中的判 0 电路：当阶码全为 0，尾数也全为 0 时，表示机器 0

   - 浮点数尾数的基数：

     - 尾数基数 $r$ 对浮点数特性的影响：
       - 可表示数的范围：随着 $r$ 的增大，可表示数的范围增大
       - 可表示数的个数：随着 $r$ 的增大，可表示数的个数增加
       - 数在数轴上的分布：随着 $r$ 的增大，数在数轴上的分布密度降低
       - 可表示数的精度：随着 $r$ 的增大，可表示数的精度单调下降
       - 运算中的精度损失：随着 $r$ 的增大，尾数右移的机会减少，可降低运算中因尾数右移所造成的精度损失
       - 运算速度：随着 $r$ 的增大，将使运算中移位的次数减少，运算速度可以提高
     - 尾数基数大小的选择：
       - 在巨型、大型和中型计算机上，浮点数尾数基数 $r$ 宜取大些
       - 在微型和小型计算机上， $r$ 宜取小些

   - IEEE 754 标准浮点数 :book:（P26）

   - 定点、浮点表示法：

     - 数值的表示范围
     - 精度
     - 数的运算
     - 溢出处理

3. **非数值数据的表示**

   - 字符和字符串的表示：
     - ASCII 字符编码
     - 字符串的的存放：
       - 向量法
       - 串表法
   - 汉字的表示：
     - 汉字国标码
     - 汉字区位码：$国标码=区位码+2020H$
     - 汉字机内码：$机内码=国标码+8080H$
   - 统一代码：

4. **十进制数和数串的表示**

5. **不同类型的数据表示举例**

6. **数据校验码**

### 指令系统

### 数值的机器运算

### 存储系统和结构

### 中央处理器

1. **中央处理器的功能和组成**

   - CPU 的功能：

     指令流指的是处理器执行的指令序列，数据流指的是根据指令操作要求依次存取数据的序列

     CPU 的基本功能就是对指令流和数据流在时间和空间上实施正确的控制

     对于冯 · 诺伊曼结构的计算机而言，数据流是根据指令流的操作而形成的，也就是说数据流是由指令流来驱动的

   - CPU 中的主要寄存器：

     - 通用寄存器：通用寄存器可用来存放原始数据和运算结果，有的还可以作为变址寄存器、计数器、地址指针等。通用寄存器一般可以由CPU直接访问，可以由程序编址访问
     - 专用寄存器：
       - 程序计数器（PC）：程序计数器用来存放正在执行的指令地址或接着要执行的下条指令地址。对于顺序执行的情况，PC 的内容应不断地增量（加“1”），以控制指令的顺序 执行
       - 指令寄存器（IR）：指令寄存器用来存放从存储器中取出的指令。当指令从主存取出暂存于指令寄存器之后，在执行指令的过程中，指令寄存器的内容不允许发生变化，以保证实现指令的全部功能
       - 存储器数据寄存器（MDR）：存储器数据寄存器用来暂时存放由主存储器读出的一条指令或一个数据字；反之，当向主存存入一条指令或一个数据字时，也暂时将它们存放在存储器数据寄存器中
       - 存储器地址寄存器（MAR）：存储器地址寄存器用来保存当前 CPU 所访问的主存单元的地址。由于主存和 CPU 之间存在着操作速度上的差别，所以必须使用地址寄存器来保持地址信息，直到主存的读/写操作完成为止
       - 程序状态字寄存器（PSW）：状态标志寄存器用来存放程序状态字的。程序状态字的各位表征程序和机器运行的状态，是参与控制程序执行的重要依据之一

   - CPU 的组成：

     CPU 包括运算器和控制器

     - 控制器的主要功能：
       - 从主存中取出一条指令，并指出下一条指令在主存中的位置
       - 对指令进行译码或测试，产生相应的操作控制信号，以便启动规定的动作
       - 指挥并控制CPU、主存和输入/输出设备之间的数据流动方向
     - 运算器的主要功能：
       - 执行所有的算术运算
       - 执行所有的逻辑运算，并进行逻辑测试

   - CPU 的主要技术参数 :book:（P172）

     - 字长
     - 内部工作频率
     - 外部工作频率：$内频=外频 \times 倍频$
     - 前端总线频率（FSB）
     - QPI 数据传输速率
     - DMI 数据传输速率
     - 片内 Cache 容量
     - 工作电压
     - 地址总线宽度
     - 数据总线宽度
     - TDP 功耗
     - 制造工艺

2. **控制器的组成和实现方法**

   - 概述：

     控制器是计算机系统的指挥中心，它把运算器、存储器、输入/输出设备等部件组成一个有机的整体，然后根据指令的要求指挥全机的工作

   - 控制器的基本组成：

     - 指令部件：
       - 程序计数器
       - 指令寄存器
       - 指令译码器
       - 地址形成部件
     - 时序部件：
       - 脉冲源
       - 启停控制逻辑：启停控制逻辑的作用是根据计算机的需要，可靠地开放或封锁脉冲，控制时序信号的发生或停止，实现对整个机器的正确启动或停止。启停控制逻辑保证启动时输出的第一个脉冲和停止时输出的最后一个脉冲都是完整的脉冲
       - 节拍信号发生器：节拍信号发生器又称脉冲分配器。脉冲源产生的脉冲信号，经过节拍信号发生器后产生出各个机器周期中的节拍信号，用以控制计算机完成每一步微操作
     - 微操作信号发生器：一条指令的取出和执行可以分解成很多最基本的操作，这种最基本的不可再分割的操作称为微操作。微操作信号发生器也称为控制单元（CU）。不同的机器指令具有不同的微操作序列
     - 中断控制逻辑：中断控制逻辑是用来控制中断处理的硬件逻辑

   - 控制器的硬件实现方法：

     控制器的输入是机器指令代码，输出是微操作控制信号，因此微操作信号发生器（CU）是控制器的核心。根据产生微操作控制信号的方式不同，控制器可分为3种：

     - 组合逻辑型：
       - 概述：这种控制器称为常规控制器或硬布线控制器，它是采用组合逻辑技术来实现的，其微操作序列形成部件是由门电路组成的复杂树形网络
       - 优点：速度快
       - 缺点：微操作信号发生器的结构不规整，使得设计、调试、维修较困难，难以实现设计自动化。一旦微操作信号发生器构成之后，要想增加新的控制功能是不可能的
     - 存储逻辑型：
       - 概述：这种控制器称为微程序控制器，它是采用存储逻辑来实现的，也就是把微操作信号代码化，使每条机器指令转化成为一段微程序并存入一个专门的存储器（控制存储器）中，微操作控制信号由微指令产生
       - 优点：设计规整、调试、维修以及更改、扩充指令方便的优点，易于实现自动化设计，已成为当前控制器的主流
       - 缺点：由于它增加了一级控制存储器，所以指令执行速度比组合逻辑控制器慢
     - 组合逻辑和存储逻辑结合型：这种控制器称为 PLA 控制器，它是组合逻辑技术和存储逻辑技术结合的产物，它克服了两者的缺点，是一种较有前途的方法

3. **时序系统与控制方式**

   - 时序系统：

     - 指令周期和机器周期：

       指令周期是指取指令、分析指令到执 行完该指令所需的全部时间，各种指令的指令周期不尽相同

       机器周期通常又称CPU周期，通常把一条指令划分为若干个机器周期，每个机器周期完成一个基本操作

     - 节拍：

       在一个机器周期内，要完成若干个微操作。这些微操作有的可以同时执行，有的需要按先后次序串行执行。因而需要把一个机器周期分为若干个相等的时间段，每一个时间段对应一个电位信号，称为节拍电位信号

       节拍的宽度取决于 CPU 完成一次基本操作的时间

       - 统一节拍法：以最复杂的机器周期为准定出节拍数，每一节拍时间的长短也以最繁的微操作作为标准。这种方法采用统一的、具有相等时间间隔和相同数目的节拍，使得所有的机器周期长度都是相等的，因此称为定长 CPU 周期

       - 分散节拍法：按照机器周期的实际需要安排节拍数，需要多少节拍，就发出多少节拍，这样可以避免浪费，提高时间利用率。由于各机器周期长度不同，又称为不定长CPU周期
       - 延长节拍法：在照顾多数机器周期要求的情况下，选取适当的节拍数，作为基本节拍，如果在某个机器周期内统一的节拍数无法完成该周期的全部微操作，则可以延长节拍
       - 时钟周期插入：在一些微型机中，时序信号中不设置节拍，而直接使用时钟周期信号。一个机器周期中含有若干个时钟周期，时钟周期的数目取决于机器周期内完成微操作的多少及相应功能部件的速度。一个机器周期的基本时钟周期数确定之后，还可以不断插入等待时钟周期

     - 工作脉冲：

       在节拍中执行的有些操作需要同步定时脉冲，为此，在一个节拍内常常设置一个或几个工作脉冲，作为各种同步脉冲的来源。工作脉冲的宽度只占节拍电位宽度 的1/n，并处于节拍的末尾，只要能保证所有触发器都可靠、稳定地翻转就可以了

     - 多级时序系统：

       - 小型机中常采用机器周期、节拍、工作脉冲三级时序系统。每个机器周期中包括若干节拍，每个节拍内有一个脉冲
       - 微型计算机常使用的时序系统与小型机的略有不同，称为时钟周期时序系统。一个指令周期包含若干个机器周期，一个机器周期又包含若干个时钟周期

   - 控制方式：

     - 同步控制方式：

       同步控制方式即固定时序控制方式，各项操作都由统一的时序信号控制，在每个机器周期中产生统一数目的节拍电位和工作脉冲。由于不同的指令，操作时间长短不一致，同步控制方式应以最复杂指令的操作时间作为统一的时间间隔标准

       在同步控制方式中，各指令所需的时序由控制器统一发出，所有微操作都与时钟同步，所以又称为集中控制方式或中央控制方式

     - 异步控制方式：

       异步控制方式即可变时序控制方式。各项操作不采用统一的时序信号控制，而根据指令或部件的具体情况决定，需要多 少时间，就占用多少时间

       由于这种控制方式没有统一的时钟，而是由各功能部件本身产生各自的时序信号自我控制，故又称为分散控制方式或局部控制方式

     - 联合控制方式：

       这是同步控制和异步控制相结合的方式。实际上现代计算机中几乎没有完全采用同步或完全采用异步的控制方式，大多数是采用联合控制方式。通常的设计思想是：在功能部件内部采用同步方式或以同步方式为主的控制方式，在功能部件之间采用异步方式

   - 指令运行的基本过程：

     - 取指令阶段：取指令阶段完成的任务是将现行指令从主存中取出来并送至指令寄存器中去
     - 分析取数阶段：取出指令后，机器立即进入分析指令阶段，指令译码器ID可识别和区分不同的指令类型及各种获取操作数的方法。由于各条指令功能不同，寻址方式也不同，所以分析取数阶段的操作是各不相同的
     - 执行阶段：执行阶段完成指令规定的各种操作，形成稳定的运算结果，并将其存储起来

   - 指令的微操作序列 :book:（P183）

4. **微程序控制原理**

   - 微程序控制的基本概念：

     - 微程序设计的提出与发展：

       微程序设计技术的实质是将程序设计技术和存储技术相结合，即用程序设计的思想方法来组织操作控制逻辑，将微操作控制信号按一定规则进行信息编码（代码化），形成控制字（微指令），再把这些微指令按时间先后排列起来，存放在一个 只读存储器中

     - 基本术语：

       - 微命令和微操作：

         一条机器指令可以分解成一个微操作序列，这些微操作是计算机中最基本的、不可再分解的操作。微命令是控制计算机各部件完成某个基本微操作的命令

         微命令和微操作是一一对应的。微命令是微操作的控制信号，微操作是微命令的操作过程

         微命令有兼容性和互斥性之分，兼容性微命令是指那些可以同时产生，共同完成某一些微操作的微命令；而互斥性微命令是指在机器中不允许同时出现的微命令

       - 微指令、微地址：

         微指令是指控制存储器中的一个单元的内容，即控制字，它是若干个微命令的集合。存放控制字的控制存储器的单元地址就称为微地址

         一条微指令通常至少包含两大部分信息：

         - 操作控制字段，又称微操作码字段，用以产生某一步操作所需的各微操作控制信号
         - 顺序控制字段，又称微地址码字段，用以控制产生下一条要执行的微指令地址

         微指令有垂直型和水平型之分，垂直型微指令接近于机器指令的格式，每条微指令只能完成一个基本操作。水平型微指令则具有良好的并行性，每条微指令可以完成较多的基本操作

       - 微周期：从控制存储器中读取一条微指令并执行相应的微命令所需的全部时间称为微周期
       - 微程序：一系列微指令的有序集合就是微程序。一条机器指令对应于一段微程序

   - 微指令编码法：

     - 直接控制法（不译码法）
     - 最短编码法
     - 字段编码法：
       - 字段直接编码法
       - 字段间接编码法
       - 分段原则：
         - 把互斥性的微命令分在同一段内，兼容性的微命令分在不同段内。这样不仅有助于提高信息的利用率，缩短微指令字长，而且有助于充分利用硬件所具有的并行性，加快执行的速度
         - 应与数据通路结构相适应
         - 每个小段中包含的信息位不能太多，否则将增加译码线路的复杂性和译码时间
         - 一般每个小段还要留出一个状态，表示本字段不发出任何微命令

   - 微程序控制器的组成和工作过程：

     - 微程序控制器的基本组成：
       - 控制存储（CM）：这是微程序控制器的核心部件，用来存放微程序
       - 微指令寄存器（μIR）：用来存放从CM取出的正在执行的微指令
       - 微地址形成部件：用来产生初始微地址和后继微地址
       - 微地址寄存器（μMAR）：它接受微地址形成部件送来的微地址，为在CM中读取微指令作准备
     - 微程序的工作过程 :book:（P188）

   - 微程序入口地址的形成 :book:（P189）

   - 后继微地址的形成 :book:（P190）

   - 微程序设计 :book:（P191）

### 总线

1. **总线概述**
   - 总线的基本概念：
     - 总线：总线是一组能为多个部件分时共享的公共信息传送线路
     - 总线的特点：
       - 分时：同一时刻总线上只能转送一个部件发送的信息
       - 共享：总线上可以挂接多个部件，各个部件之间相互交换的信息都可以通过这组公共线路传送
     - 三态门：具有三种逻辑状态的门电路称为三态门。 这三种状态是“0”状态、“1”状态和浮空状态（高阻状态）。高阻状态由控制端控制
     - 三态门的作用：三态门主要用于总线连接，各个部件或设备必须通过三态门才能挂在总线上，通过控制端选择工作部件或设备
     - 单向总线和双向总线：
       - 单向总线上的信息只能向一个方向传送，如地址总线
       - 双向总线上的信息可以向两个方向上传送，如数据总线
     - 总线事务：通常把在总线上一对设备之间的一次信息交换过程称为一个“总线事务”，把发出总线事务请求的部件称为主设备，与主设备进行信息交换的对象称为从设备。一次总线事务简单来说包括两个阶段：地址阶段和数据阶段
   - 总线的分类：
     - 按功能层次分类：
       - 片内总线：是芯片内部的总线，一般是看不见的
       - 系统总线（内总线）：是计算机系统内各功能部件之间相互连接的总线，是构成计算机的主要组成部分。分为数据总线、地址总线和控制总线
       - 通信总线（外总线）：是用于计算机系统之间或计算机系统与其他系统之间信息传送的总线
     - 按数据线的多少分类：
       - 并行总线：
         - 概念：含有多条双向数据线，可以实现一个数据的多位同时传输
         - 优点：数据传输率高
         - 缺点：由于各条数据线的传输特性不可能完全一致，当数据线较长时，接收延迟可能不一致，会造成传输错误
       - 串行总线：
         - 概念：只含有一条双向数据线或两条单向数据线的总线，可以实现一个数据的各位按照一定的速度和顺序依次传输
         - 优点：在长距离连线下仍可以有效传送数据
         - 缺点：数据传输率较低
   - 总线结构：
     - 单总线结构：只有一条系统总线，所有部件通过系统总线接入
     - 双总线结构：在单总线的基础上增加一条专用于 CPU 和主存之间的数据传送通路
     - 三总线结构：在双总线的基础上再增加一条 I/O 总线。I/O 总线是多个外部设备与通道之间进行数据传送的公共通路
   - 总线的性能指标：
     - 总线宽度：指总线的线数
     - 总线带宽：定义为总线的最大数据传输率，即每秒传输的字节数。$B=\frac{W \times F}{N}$，其中 $B$ 为总线带宽；$W$ 为数据总线宽度，常以字节为单位；$F$ 为总线的时钟频率；$N$ 为完成一次数据传送所用的时钟周期数
     - 总线负载：指连接在总线上的最大设备数量。大多数总线的负载能力是有限的
     - 总线复用：是指在不同时间段利用总线上同一个信号线传送不同信号。例如地址总线和数据总线共用一组信号线。采用这种方式的目的是减少总线数量，提高总线利用率
     - 总线猝发传输：猝发（突发）式数据传输是一种总线传输方式，即在一个总线周期中可以传输存储地址连续的多个数据
2. **总线标准**
   - 内部总线标准：
     - PC/XT 总线
     - ISA 总线
     - MCA 总线
     - EISA 总线
     - VL 总线（VESA 局部总线）
     - PCI 局部总线
     - AGP 
     - PCI-Express
   - 外部总线标准：
     - 串口
     - 并口
     - USB 接口
     - IEEE-1394 接口
     - eSATA 接口

### 外部设备

1. **外部设备概述**

   - 外部设备的分类：
     - 输入输出设备
     - 辅助存储器：辅助存储器即外存储器，它是指主机以外的存储装置，又称为后援存储器
     - 终端设备：终端设备由输入设备、输出设备和终端控制器组成，通常通过通信线路与主机相连
     - 过程控制设备：模**/**数、数**/**模转换设备均是过程控制设备，有关的检测设备也属于过程控制设备
   - 外部设备的地位和作用：
     - 外部设备是人机对话的通道
     - 外部设备是完成数据媒体变换的设备
     - 外部设备是计算机系统软件和信息的驻在地
     - 外部设备是计算机在各领域应用的桥梁

2. **磁介质存储器的性能和原理**

   - 磁介质存储器的读写：
     - 磁记录介质与磁头：
       - 磁记录介质：在磁介质存储器中，信息是记录在一薄层磁性材料的表面上，这个薄层称为磁层。磁层与所附着的载体被称为记录介质或记录媒体
       - 磁头：磁头是磁记录设备的关键部件之一，它是一种电磁转换元件。写磁头实现把电脉冲表示的二进制代码转换成磁记录介质上的磁化状态，即电-磁转换；读磁头实现把磁记录介质上的磁化状态转换成电脉冲，即磁-电转换
     - 写入过程
     - 读出过程
   - 磁介质存储器的技术指标：
     - 记录密度：
       - 定义：记录密度是指磁介质存储器单位长度或单位面积磁层表面所能存储的二进制信息量。通常以道密度和位密度表示，也可用两者的乘积面密度来表示
       - 道密度：又叫横向密度，是指垂直于磁道方向上单位长度中的磁道数目，道密度的单位是道/英寸（TPI）或道/毫米（TPM）
       - 位密度又叫纵向密度，是指沿磁道方向上单位长度中所能记录的二进制信息的位数，位密度的单位为位/英寸（BPI）或位 /毫米（BPM）
     - 存储容量：
       - 定义：存储容量是指整个磁介质存储器所能存储的二进制信息的总量，一般用位或字节为单位表示，它与存储介质尺寸和记录密度直接相关
       - 非格式化容量：是指磁记录表面上可全部利用的磁化单元数
       - 格式化容量：是指用户实际可以使用的存储容量。格式化容量一般约为非格式化容量的60~80%左右
     - 平均存取时间：
       - 定义：当磁头接到读**/**写命令，从原来的位置移动到指定位置，并完成读**/**写操作的时间叫存取时间
       - 存取时间包括4个部分：
         - 定位时间（寻道时间）：是指磁头从原先位置移动到目的磁道所需要的时间
         - 旋转时间（等待时间）：是指在到达目的磁道以后，等待被访问的记录块旋转到磁头下方的等待时间
         - 传输时间：信息的读写操作时间
         - 磁盘控制器的开销
       - 其主导作用的是寻道时间和等待时间
     - 数据传输率：磁介质存储器在单位时间内向主机传送数据的位数或字节数。$D_r=D \times v$，其中 $D_r$ 为数据传输率；$D$ 为记录密度；$v$ 为速度
     - 误码率：误码率是衡量磁介质存储器出错概率的参数，它等于读出的出错信息位数和读出总的信息位数之比
   - 数字磁记录方式：:book:（P236）
     - 直接记录方式：
       - 归零制（RZ）
       - 不归零制（NRZ）
       - 不归零-1制（NRZ-1）
     - 按位编码记录方式：
       - 调相制（PE）
       - 调频制（FM）
       - 改进的调频制（MFM）
       - 改进的改进调频制（M<sup>2</sup>FM）

3. **磁介质存储器**

   - 硬盘的信息分布：

     - 记录面：硬盘驱动器中可有多个盘片（数量为1~20片），每个盘片有两个记录面，每个记录面对应一个磁头
     - 磁道：在读**/**写时，磁头固定不动，盘片高速旋转，磁化区构成一个闭合圆环，称为磁道。在盘面上，一条条磁道形成一组同心 圆，最外圈的磁道为0号，往内则磁道号逐步增加。（每个盘片可有500~2500条磁道）
     - 圆柱面：在一个盘组中，各记录面上相同编号（位置）的诸磁道构成一个圆柱面。硬盘的圆柱面数等于一个记录面上的磁道数，圆柱面号即对应的磁道号
     - 扇区：通常将一条磁道划分为若干个段，每个段称为一个扇区或扇段，每个扇区存放一个定长信息块（如512个字节）。一条磁道划分多少扇区，每个扇区可存放多少字 节，一般由操作系统决定。磁道上的扇区编号从1号开始

   - 磁盘地址：

     驱动器号、圆柱面（磁道）号、记录面（磁头）号、扇区号

   - 磁盘存储器的技术参数 :book:（P241）：

     - 磁盘的主要技术指标：
       - 磁盘容量
       - 磁盘转速
       - 道密度
       - 平均存取时间
       - 缓存
       - 数据传输率
     - 磁盘的接口标准
     - 磁盘参数的计算

   - 磁盘的分区域记录：

     采用分区域记录（等位密度）技术可以增加硬盘驱动器的容量。由于外圈磁道有更长的周长，所以外层磁道要比内层磁道包含更多的扇区，即外圈磁道上保存的信息比内圈磁道多

   - 磁盘的 NCQ 技术：

     通过对内部队列中的命令进行重新排序实现智能数据管理，避免像传统硬盘那样机械地按照接收命令的先后顺序移动磁头读写硬盘的不同位置，从而减少了磁头反复移动带来的损耗，延长了硬盘的寿命

4. **键盘输入设备**

   - 编码键盘和非编码键盘：
     - 编码键盘：具有识别有无键按下和哪个键被按下的能力，并能将按下的那个键的代码给计算机。编码键盘又有静态编码键盘和动态编码键盘之分
     - 非编码键盘：通过执行键盘扫描程序对键盘进行扫描，以识别按键的位置，并提供与按下的键对应的位置码（扫描码），然后将位置码通过查 ROM 表转换成对应的 ASCII 码。这种键盘的响应速度不如编码键盘，但是它通过软件编程可为键盘中某些键的重新定义提供更大的灵活性，因此得到广泛地使用。

5. **打印输出设备**

   - 概述：

     打印机是计算机系统的主要输出设备之一，它能将计算机的处理结果以字符或 图形的形式印刷到纸上，便于人们阅读和 保存。由于输出结果能永久性保留，常称为硬拷贝输出设备

   - 文本模式和图形模式：
     - 文本模式：主机向打印机输出字符代码（ASCII）或汉字代码（国标码），打印机则依据代码从其点阵字库中取出点阵数据，控制打印针打出相应字符或汉字。文本模式所需传送的数据量少，占用主CPU时间少，因而效率较高，但所能打印的字符或汉字较少
     - 图形模式：主机向打印机输出点阵图形数据，打印机控制器直接根据图形数据驱动打印针打出，即有一个“1”就打印一个点。在这种模式下，CPU能灵活控制打印机输出任意图形，从而可打印出字符、汉字、图表、图形、图像等。但图形模式所需传送的数据量大，占用主机大量的时间
   - 打印机的主要性能指标：
     - 分辨率
     - 打印速度和打印幅面
     - 接口方式
     - 缓冲区
   - 针式打印机工作原理 :book:（P267）
   - 喷墨打印机工作原理 :book:（P269）
   - 激光打印机工作原理 :book:（P270）

6. **显示设备**

   - 显示设备概述：

     显示设备是将电信号转换成视觉信号的一种装置，显示器输出的内容不能长期保存，当显示器关机或显示别的内容时，原有内容就消失了，所以显示设备属于软拷贝输出设备

     计算机系统中的显示设备可分为字符显示器、图形显示器和图像显示器

     按显示原理可分为两类。一类是主动显示器件，如 CRT 显示器、发光二极管等，它们是在外加电信号作用下，依靠器件本身产生的光辐射进行显示的，因此也叫光发射器件。另一类叫做被动显示器件，如液晶显示器，这类器件本身不发光，工作时需另设光源，在外加电信号的作用下，依靠材料本身的光学特性变化，使照射在它上面的光受到调制，因此这类器件又叫光调制器件

   - CRT 显示器：

     - CRT 显示器的主要技术指标：
       - 点距
       - 行频和场频：行频又称水平扫描频率，是电子枪每秒在屏幕上扫描过的水平线条数，以 KHz 为单位。场频又称垂直扫描频率，是每秒钟屏幕重复绘制显示画面的次数，以 Hz 为单位
       - 视频带宽：视频带宽是表示显示器显示能力的一个综合性指标，以 MHz 为单位。它指每秒钟扫描的像素个数，即单位时间内每条扫描线上显示的点数的总和。带宽越大表明显示器显示控制能力越强，显示效果越佳。$视频带宽=水平分辨率\times垂直分辨率\times刷新率\times1.344$
       - 最高分辨率
       - 刷新率：刷新率实际上就等于场频
       - 屏幕尺寸
     - CRT 显示原理 :book:（P273）

   - 字符显示器的工作原理 :book:（P275）：

     - 字符显示原理
     - VRAM 的地址组织
     - 字符显示器的控制电路

   - 图形显示器的工作原理 :book:（P277）

### 输入输出系统

1. **主机与外设的连接**

   - 输入输出接口：

     - 数据信息
     - 控制信息
     - 状态信息
     - 外设识别信息

   - 接口的功能和基本组成：

     - 接口的功能：
       - 实现主机和外设的通信联络控制
       - 进行地址译码和设备选择
       - 实现数据缓冲
       - 数据格式的变换
       - 传递控制命令和状态信息
     - 接口的基本组成：
       - 接口与端口是两个不同的概念。端口是指接口电路中可以进行读**/**写的寄存器，若干个端口加上相应的控制逻辑电路才组成接口
       - 通常，一个接口中包含有数据端口、控制端口和状态端口。存放数据信息的寄存器称为数据端口，存放控制命令的端口称为命令端口，存放状态信息的寄存器称为状态端口
       - CPU 通过输入指令可以从有关端口中读出信息，通过输出指令可以把信息写入有关端口
       - 对状态端口只进行输 入操作，将设备状态标志送到 CPU 中去；对命令端口只进行输出操作，CPU 将向外设发送各种控制命令
       - 为节省硬件，在有的接口电路中状态信息和控制信息共用一个寄存器（端口），称之为设备的控制/状态寄存器
     - 接口类型

   - 外设的识别与端口寻址：

     - 端口地址编址方式：
       - I/O 端口编址方式有两种：一种是 I/O 映射方式，即把 I/O 端口地址与主存单元地址分别进行独立的编址；另一种是存储器映射方式，即把端口地址与主存单元地址统一编址
       - 独立编址：主存地址空间和 I/O 端口地址空间是相对独立的，分别单独编址。CPU 访问主存时，由主存读/写控制线控制;访问外设时，由 I/O 读/写控制线控 制，所以在指令系统中必须设置专门的 I/O 指令。当 CPU 使用 I/O 指令时，其指令的地址字段直接或间接的指示出端口地址
       - 统一编址：I/O 端口地址和主存单元的地址是统一 编址的，把 I/O 接口中的端口作为主存单元一样进行访问，不设置专门的 I/O 指令
     - 独立编址方式的端口访问：Intel 80x86 最多可直接寻址256个字节端口，可间接寻址65536个字节端口

   - 输入输出信息传送过程方式：

     按其发展的先后次序和主机与外设并行工作的程度，可以分为四种：

     - 程序查询方式：程序查询方式是一种程序直接控制方式，这是主机与外设间进行信息交换的最简单方式，输入和输出完全是通过 CPU 执行程序来完成的。这种方式控制简单，但外设和主机不能同时工作，各外设之间也不能同时工作，系统效率很低，因此，仅适用于外设的数目不多，对 I/O 处理的实时要求不那么高，CPU 的操作任务比较单一，并不很忙的情 况
     - 程序中断方式：外设在作好输入/输出准备时，向主机发中断请求，主机接到请求后就暂时中止原来执行的程序，转去执行中断服务程序对外部请求进行处理，在中断处理完毕后返回原来的程序继续执行。程序中断不仅允许主机和外设同时并行工作，并且允许一台主机管理多台外设。 但是完成一次程序中断需要许多辅助操作，可能使 CPU 应接不暇；对于一些高速外设，可能会造成信息丢失，因此，它主要适用于中、低速外设
     - 直接存储器（DMA）方式：DMA 方式是在主存储器和外部设备之间开辟直接的数据通路，可以进行基本上不需要 CPU 介入的主存和外设之间的信息传送，这样不仅能保证 CPU 的高效率，而且能满足高速外设的需要。DMA 方式只能进行简单的数据传送操作，在数据块传送的起始和结束时还需 CPU 及中断系统进行预处理和后处理
     - I/O 通道控制方式：通道是一个具有特殊功能的处理器，它能独立地执行通道程序，产生相应的控制信号，实现对外设的统一管理和外设与主存之间的数据传送。但它不是一个完全独立的处理机，它要在 CPU 的 I/O 指令指挥下才能启动、停止或改变工作状态，是从属于 CPU 的一个专用处理器。一个通道执行输入/输出过程全部由通道按照通道程序自行处理，不论交换信息多少，只打扰 CPU 两次（启动和停止时）。主机、外设和通道可以并行同时工作，而且一个通道可以控制多台不同类型的设备

2. **程序查询方式及其接口**

   - 程序查询方式：

     - 程序查询的基本思想：

       由 CPU 执行一段输入、输出程序来实现主存与外设之间的数据传送方式，叫做程序直接控制方式。根据外设的不同性质，这种传送方式又可分为无条件传送和程序查询方式两种：

       - I/O 接口总是准 备好接收主机的输出数据，或总是准备好向主机输入的数据，因而 CPU 无需查询外设 的工作状态，而默认外设始终处于准备就绪状态
       - 许多外设的工作状态是很难事先预知的，为了保证数据传送的正确进行，就要求 CPU 在程序中查询外设的工作状态，如果外设尚未准备就绪，CPU 就等待，只有外设已作好准备，CPU 才能执行 I/O 指令，这就是程序查询方式

     - 程序查询方式的工作流程：

       - 预置传送参数：在传送数据之前，由 CPU 执行一段程序，预置传送参数。传送参数包括存取数据的主存缓冲区首地址和传送数据的个数
       - 向外设接口发出命令字：当 CPU 选中某台外设时，执行输出指令向 I/O 接口发出命令字，启动外设，为接收数据或发送数据的操作做准备
       - 从外设接口取回状态字：CPU 执行输入指令，从 I/O 接口中取回状态字并进行测试，判断数据传送是否可以进行
       - 查询外设标志：CPU 不断查询状态标志，如果外设没有准备就绪，CPU 就踏步进行等待，一直到这个外设准备就绪，并发出“准备就绪”信号为止
       - 传送数据：只有外设准备好，才能实现主机与外设间的一次数据传送。输入时，CPU执行输入指令，从 I/O 接口的数据缓冲寄存器中接收数据；输出时，CPU 执行输出指令，将数据写入 I/O 接口的数据缓冲寄存器
       - 修改传送参数：每进行一次数据传送，需要修改传送参数，其中包括主存缓冲区地址加1，传送个数减1
       - 判断传送是否结束：如果传送个数不为0，则转第3步，继续传送，直到传送结束为止

   - 程序查询方式接口：

     通常接口中至少有两个寄存器，一个是数据缓冲寄存器，即数据端口，用来存放与 CPU 进行传送的数据信息，另一个是供 CPU 查询的设备状态寄存器，即状态端口，这个寄存器由多个标志位组成，其中最重要的是设备准备就绪标志

3. **中断系统和程序中断方式**

   - 中断的基本概念：

     - 中断的提出：

       程序查询方式存在着下列明显的缺点：

       - 在查询过程中，CPU 长期处于踏步等待状态，使系统效率大大降低
       - CPU 在一段时间内只能和一台外设交换信息，其它设备不能同时工作
       - 不能发现和处理预先无法估计的错误和异常情况

       中断系统是计算机实现中断功能的软、硬件总称。一般在 CPU 中配置中断机构，在外设接口中配置中断控制器，在软件上设计 相应的中断服务程序

     - 程序中断与调用子程序的区别：

       它们之间是有着本质上的区别的：

       - 子程序的执行是由程序员事先安排好的（由一条调用子程序指令转入），而中断服务程序的执行则是由随机的中断事件引起的
       - 子程序的执行受到主程序或上层子程序的控制， 而中断服务程序一般与被中断的现行程序毫无关系
       - 不存在同时调用多个子程序的情况，而有可能发生多个外设同时请求 CPU 为自己服务的情况

     - 中断的基本类型：

       - 自愿中断和强迫中断：
         - 自愿中断又称程序自中断，它不是随机产生的中断，而是在程序中安排的有关指令，这些指令可以使机器进入中断处理的过程，如:指令系统中的软件中断指令等
         - 强迫中断是随机产生的中断，不是程序中事先安排好的。当这种中断产生后，由中断系统强迫计算机中止现行程序并转入中断服务程序
       - 程序中断和简单中断：
         - 程序中断就是我们前面提到的中断，主机在响应中断请求后，通过执行一段中断服务程序来处理更紧迫的任务
         - 简单中断就是外设与主存间直接进行信息交换的方法，即 DMA 方式。这种“中断”不去执行中断服务程序，故不破坏现行程序的状态。主机发现有简单中断请求（也就是 DMA 请求）时，将让出一个或几个存取周期供外设与主存交换信息，然后继续执行程序
       - 内中断和外中断：
         - 内中断是指由于 CPU 内部硬件或软件原因引起的中断
         - 外中断是指 CPU 以外的部件引起的中断
       - 向量中断和非向量中断：
         - 向量中断是指那些中断服务程序的入口地址是由中断事件自己提供的中断。中断事件在提出中断请求的同时，通过硬件向主机提供中断服务程序入口地址，即向量地址
         - 非向量中断的中断事件不能直接提供中断服务程序的入口地址，而由 CPU 查询之后得到
       - 单重中断和多重中断：
         - 单重中断在 CPU 执行中断服务程序的过程中不能被再打断
         - 多重中断在执行某个中断服务程序的过程中，CPU 可去响应级别更高的中断请求，又称为中断嵌套

   - 中断请求和中断判优：

     - 中断源和中断请求信号：中断源是指中断的来源，即任何引起计 算机中断的事件，一般计算机都有多个中断源。由于每个中断源向 CPU 发出中断请求的时间是随机的，为了记录中断事件并区分不同的中断源，可采用具有存储功能的触发器来记录中断源，称为中断请求触发器

     - 中断请求信号的传送：

       - 独立请求线：每个中断源单独设置中断请求线，将中断请求信号直接送往 CPU，这种方式的 特点是 CPU 在接到中断请求的同时也就知道了中断源是谁，其中断服务程序的入口地址在哪里
       - 公共请求线：多个中断源共有一根公共请求线，这种方式的特点是在负载允许的情况下，中断源的数目可随意扩充，但 CPU 在接到中断请求后，必须通过软件或硬件的方法来识别中断源，然后再找出中断服务程序的入口地址
       - 二维结构：将中断请求线连成二维结构，同一优先级别的中断源， 采用一根公共的请求线，不同请求线上的中断源优先级别不同，这种方式综合了前两种方式的优点，在中断源较多的系统中常采用这种方式

     - 中断优先级与判优方法：

       当多个中断源同时发出中断请求时， CPU 在任何瞬间只能接受一个中断源的请求。通常，把全部中断源按中断的性质和处理的轻重缓急安排优先级，并进行排队

       确定中断优先级的原则是：对那些提出中断请求后需要立刻处理，否则就会造成严重后果的中断源规定最高的优先级；而对那些可以延迟响应和处理的中断源规定较低的优先级。如故障中断一般优先级较高，接着才是 I/O 设备中断。而在 I/O 设备中又可以根据各个设备的速度来决定优先级

       每个中断源均有一个为其服务的中断服务程序，每个中断服务程序都有与之对应的优先级别。另外，CPU 正在执行的程序也有优先级。只有当某个中断源的优先级别高于 CPU 现在的优先级时，才能中止 CPU 执行现在的程序

       判优方法：

       - 软件判优方法：就是用程序来判别优先级，这是最简单的中断判优方法。当 CPU 接到中断请求信号后，就执行查询程序，逐个检测中断请求寄存器的各 位状态，检测顺序是按优先级的大小排列的，最先检测的中断源具有最高的优先级，其次检测的中断源具有次高优先级，如此下去，最后检测的中断源具有最低的优先级。软件判优是与识别中断源结合在一起的，当查询到中断请求信号的发出者，也就是找到了中断源，程序立即可以转入对应的中断服务程序中去

         优点：方法简单，可以灵活地修改中断源的优先级别

         缺点：查询、判优完全是靠程序实现的，不但占用 CPU 时间，而且判优速度慢

       - 硬件判优电路：

         常见的有，独立请求线的优先排队电路和公共请求线的优先排队电路

         优点：节省 CPU 时间，速度快

         缺点：成本较高

   - 中断响应和中断处理：

     - CPU 响应中断的条件：

       - CPU 接收到中断请求信号
       - CPU 允许中断：CPU 处于开中断状态
       - 一条指令执行完毕

     - 中断隐指令：

       CPU 响应中断之后，经过某些操作，转去执行中断服务程序。 这些操作是由硬件直接实现的，我们把它称为中断隐指令。中断隐指令并不是指令系统中的一条真正的指令，它没有操作码，所以中断隐指令是一种不允许、也不可能为用户使用的特殊指令

       其所完成的操作主要有：

       - 保存断点
       - 暂不允许中断
       - 引出中断服务程序

     - 中断周期 :book:（P301）

     - 进入中断服务程序：

       向量中断时，中断源向 CPU 发出中断请求信号之后，CPU 经过一定的判优处理，若决定响应这个中断请求，则向中断源发出中断响应信号。中断源接到中断响应信号后就通过自己的向量地址发生器向 CPU 发送向量地址

       向量地址包括两种情况：

       - 向量地址是中断服务程序的入口地址：CPU 不需要再经过处理就可以进入相应的中断服务程序
       - 向量地址是中断向量表的指针：向量地址指向一个中断向量表，从中断向量表的相应单元中再取出中断服务程序的入口地址，此时中断源给出的向量地址是中断服务程序入口地址的地址

     - 中断现场的保护和恢复：中断现场指的是发生中断时 CPU 的主要状态，其中最重要的是断点，另外还有一些通用寄存器的状态。之所以需要保护和恢复现场的原因是因为 CPU 要先后执行两个完全不同的程序（现行程序和中断服务程序），必须进行两种程序运行状态的转换。一般来说，在中断隐指令中，CPU 硬件将自动保存断点，有些计算机还自动保存程序状态寄存器的内容。但是，在许多应用中，要保证中断返回后原来的程序能正确地继续运行，仅保存这一、二个寄存器的内容是不够的。为此，在中断服务程序开始时，应由软件去保存那些硬件没有保存，而在中断服务程序中又可能用到的寄存器（如某些通用寄存器）的内容，在中断返回之前，这些内容还应该被恢复。现代计算机一般都先采用硬件方法来自动快速的保护和恢复部分重要的现场，其余寄存器的内容再由软件完成保护和恢复，这种方法的硬件支持是堆栈

   - 多重中断与中断屏蔽：

     - 中断嵌套：中断嵌套的层次可以有多层， 越在里层的中断越急迫，优先级越高，因此优先得到 CPU 的服务

     - 允许和禁止中断：

       允许中断即开中断，下列情况时应开中断：

       - 在中断服务程序执行完毕，恢复中断现场之后
       - 在多重中断的情况下，保护中断现场之后

       禁止中断即关中断，下列情况时应关中断：

       - 当响应某一级中断请求，不再允许被其他中断请求打断时
       - 在中断服务程序的保护和恢复现场之前

     - 中断屏蔽：中断源发出中断请求之后，这个中断请求并不一定能真正送到 CPU 去，在有些情况下，可以用程序方式有选择地封锁部分中断，这就是中断屏蔽

     - 中断升级：

       中断屏蔽字的另一个作用是可以改变中断优先级，将原级别较低的中断源变成较高的级别，我们称之为中断升级

       这里所说的改变优先次序是指改变中断的处理次序。中断处理次序和中断响应次序是两个不同的概念，中断响应次序是由硬件排队电路决定的，无法改变。但是，中断处理次序是可以由屏蔽码来改变的，故把屏蔽码看成软排队器。中断处理次序可以不同于中断响应次序

   - 中断全过程：

     - 中断请求
     - 中断判优
     - 中断响应
     - 中断处理：
       - 准备部分：其基本功能是保护现场，对于非向量中断方式则需要确定中断源，最后开放中断，允许更高级的中断请求打断低级的中断服务程序
       - 处理部分：即真正执行为某个中断源服务的中断服务程序
       - 结尾部分：首先要关中断，以防 止在恢复现场过程中被新的中断打断，接着 恢复现场，然后开放中断，以便返回原来的程序后可响应其它的中断请求
     - 中断返回

4. **DMA 方式及其接口**

   - DMA 方式的基本概念：

     - DMA 方式的特点：

       无论程序查询还是程序中断方式，主要的工作都是由 CPU 执行程序完成的，这需要花费时间，因此不能实现高速外设与主机的信息交换。直接存储器访问 DMA 方式是在外设和主存储器之间开辟一条“直接数据通道” ，在不需要 CPU 干预也不需要软件介入的情况下在两者之间进行的高速数据传送方式

       特点：

       - 它使主存与 CPU 的固定联系脱钩，主存既可被 CPU 访问，又可被外设访问
       - 在数据块传送时，主存地址的确定， 传送数据的计数等等都用硬件电路直接实现
       - 主存中要开辟专用缓冲区，及时供给和接收外设的数据
       - DMA 传送速度快，CPU 和外设并行工作，提高了系统的效率
       - DMA 在开始前和结束后要通过程序 和中断方式进行预处理和后处理

     - DMA 和中断的区别：

       - 中断方式是程序切换，需要保护和恢复现场；而 DMA 方式除了开始和结尾时，不占用 CPU 的任何资源
       - 对中断请求的响应只能发生在每条指令执行完毕时；而对 DMA 请求的响应可以发生在每个机器周期结束时
       - 中断传送过程需要 CPU 的干预；而 DMA 传送过程不需要 CPU 的干预，故数据传送速率非常高，适合于高速外设的成组数据传送
       - DMA 请求的优先级高于中断请求
       - 中断方式具有对异常事件的处理能力；而 DMA 方式仅局限于完成传送信息块的 I/O 操作

   - DMA 接口：

     - DMA 控制器的功能：
       - 接受外设发出的 DMA 请求，并向 CPU 发出总线请求
       - 当 CPU 响应此总线请求，发出总线响应信号后，接管对总线的控制，进入DMA 操作周期
       - 确定传送数据的主存单元地址及传送长度，并能自动修改主存地址计数值和传送长度计数值
       - 规定数据在主存与外设之间的传送方向，发出读/写或其他控制信号，并执行数据传送的操作
       - 向 CPU 报告 DMA 操作的结束
     - DMA 控制器的基本组成：
       - 主存地址计数器：用来存放主存中要交换数据的地址，该计数器的初始值为主存缓冲区的首地址，当 DMA 传送时，每传送一个数据，将地址计数器加“1”，从而以增量方式给出主存中要交换的一批数据的地址，直至这批数据传送完毕为止
       - 传送长度计数器：用来记录传送数据块的长度，其初始值为传送数据的总字数或总字节数，每传送一个字或一个字节，计数器自动减“1”，当其内容为“0”时表示数据已全部传送完毕
       - 数据缓冲寄存器
       - DMA 请求触发器：每当外设准备好一个数据后给出一个控制信号，使 DMA请求触发器置位，控制/状态逻辑经系统总线向 CPU 发出总线请求（HOLD），如果 CPU 响应，发回批准信号（HLDA），DMA 控制器接管总线控制权，向系统总线送出传送命令与总线地址。控制/状态逻辑接收此信号后使 DMA 请求触发器复位，为交换下一个数据做准备
       - 控制/状态逻辑
       - 中断机构：当一个数据块传送完毕，由溢出信号触发中断机构，向 CPU 提出中断请求，CPU 将进行 DMA 传送的结尾处理
     - DMA 控制器的引出线：
       - 地址线：在 DMA 方式下，呈输出状态，可对主存进行地址选择；在 CPU 方式下，呈输入状态，可对 DMA 控制器中的有关寄存器进行寻址
       - 数据线：在 DMA 方式下，用它进行数据传送；在 CPU 方式下，可对 DMA 控制器的有关寄存器进行编程
       - 控制数据传送方式的信号线
       - DMA 控制器与外设之间的联络信号线
       - DMA 控制器与 CPU 之间的联络信号线
     - DMA 控制器的连接和传送 :book:（P312）

   - DMA 传送方法与传送过程：

     - DMA 传送方法：

       - CPU 停止访问主存法：用 DMA 请求信号迫使 CPU 让出总线控制权，CPU 在现行机器周期执行完成之后，使其数据、地址总线处于三态，并输出总线 批准信号。每次 DMA 请求获得批准后，DMA 控制器获得总线控制权以后，连续占用若干个存取周期（总线周期）进行成组连续的数据传送，直至批量传送结束，DMA 控制器才把总线控制权交回 CPU。在 DMA 操作期间，CPU 处于保持状态，停止访问主存，仅能进行一些与总线无关的内部操作。这种方法只适用于高速外设的成组传送
       - 存储器分时法：把原来的一个存取周期分成两个时间片，一片给 CPU，一片给 DMA，使 CPU 和 DMA 交替地访问主存。这种方法不需要申请和归还总线，使总线控制权的转移几乎不需要什么时间，所以对 DMA 传送来讲效率 是很高的，而且 CPU 既不停止现行程序的运行，也不进入保持状态，在 CPU  不知不觉中便进行了 DMA 传送，但这种方法需要主存在原来的存取周期内为两个部件服务，如果要维持 CPU 的访存速度不变，就要求主存的工作速度提高一倍。另外，由于大多数外设的速度都不能与 CPU 相匹配，所以供 DMA 使用的时间片可能成为空操作，将会造成一些不必要的浪费
       - 周期挪用法：周期挪用法是前两种方法的折衷。一旦外设有 DMA 请求并获得 CPU 批准后，CPU 让出一个周期的总线控制权，由 DMA 控制器控制系统总线，挪用一个存取周期进行一次数据传送，传送一个字节或一个字，然后，DMA 控制器将总线控制权交回 CPU，CPU 继续进行自己的操作，等待下一个 DMA 请求的到来；重复上述过程，直至数据块传送完毕。如果在同一时刻，发生 CPU 与 DMA 的访存冲突，那么优先保证 DMA 工作，而 CPU 等待一个存取周期。若 DMA 传送时 CPU 不需要访存，则外设的周期挪用对 CPU 执行程序无任何影响

     - DMA 传送过程：

       - DMA 预处理：

         这是在 DMA 传送之前做的一些必要的准备工作，是由 CPU 来完成的。CPU 首先执行几条 I/O 指令，用于测试外设的状态、向 DMA 控制器的有关寄存器置初值、设置传送方向、启动该外部设备等

         在这些工作完成之后，CPU 继续执行原来的程序，在外设准备好发送的数据 （输入时）或接收的数据已处理完毕（输出时），外设向 DMA 控制器发 DMA 请求，再由 DMA 控制器向 CPU 发总线请求

       - 数据传送：

         DMA 的数据传送可以是以单字节（或字）为基本单位，也可以以数据块为基本单位。对于以数据块为单位的传送，DMA 占用总线后的数据输入和输出操作都是通过循环来实现的。

         需要特别指出的是，这一循环不是由 CPU 执行程序实现的，而是由 DMA 控制器实现的

       - DMA 后处理：

         当长度计数器计为0时，DMA 操作结束，DMA 控制器向 CPU 发中断请求，CPU 停止原来程序的执行，转去执行中断服务程序做 DMA 结束处理工作

5. **通道控制方式**

   - 通道的基本概念：
     - 通道控制方式与 DMA 方式的区别：
       - DMA 控制器是通过专门设计的硬件控制逻辑来实现对数据传送的控制；而通道则是一个具有特殊功能的处理器，它具有自己的指令和程序，通过执行一个通道程序实现对数据传送的控制，故通道具有更强的独立处理数据输入/输出的功能
       - DMA 控制器通常只能控制一台或少数几台同类设备；而一个通道则可以同时控制许多台同类或不同类的设备
     - 通道的功能：
       - 接受 CPU 的 I/O 指令，按指令要求与指定的外设进行联系
       - 从主存取出属于该通道程序的通道指令，经译码后向设备控制器和设备发送各种命令
       - 实施主存和外设间的数据传送
       - 从外设获得设备的状态信息，形成并保存通道本身的状态信息，根据要求将这 些状态信息送到主存的指定单元，供 CPU 使用
       - 将外设的中断请求和通道本身的中断请求按次序及时报告 CPU